<!doctype html>
<html>

<head>
	<link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>
		Online Ray Tracing Tool
	</title>

	<style>
		canvas {
			padding: 0;
		}

		canvas:focus {
			outline: none;
		}

		input {
			text-align: center;
		}

		#doge1,
		#doge2 {
			display: none;
			position: absolute;
			width: 40px;
		}

	</style>
</head>

<body class="blue lighten-5">
	<script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="js/materialize.min.js"></script>
	<script type="text/javascript" src="js/RayTracing.js"></script>
	<script type="text/javascript" src="js/OBJParser.js"></script>
	<div class="container" style="width:85%">
		<div class="row">
			<div class="col s12 m12 l8" id="canv_area">
				<div class="card-panel" style="padding:0;line-height:0;position:relative;">
					<canvas id="canv" class="" tabindex="0" width="340" height="300" style="width:100%;">Please use Chrome</canvas>
					<div class="progress" style="margin:0;display:none;">
						<div class="determinate" style="width:0%;margin:0;-webkit-transition: none;transition: none;"></div>
					</div>
					<img id="doge1" src="img/doge1.png" style="right:-40px;">
					<img id="doge2" src="img/doge2.png" style="left:-40px;">
				</div>
			</div>
			<div class="col s12 m12 l4">
				<div class="card-panel">
					<div class="row">
						<div class="col s10 m6 l12">
							<p>
								<a onclick="startTracing();" class="btn waves-effect waves-light" style="width:60%;">Run</a>
							</p>
							<p>
								<a onclick="pause();" class="btn waves-effect waves-light" style="width:60%;">Pause</a>
							</p>
							<div class="divider"></div>
							<p>
								<a onclick="pause();saveProgress();" class="btn waves-effect waves-light" style="width:100%;">Save Progress</a>
							</p>
							<p>
								<a onclick="loadProgress();" class="btn waves-effect waves-light" style="width:100%;">Load Progress</a>
							</p>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		var canv = $('#canv')[0];
		var ctx = canv.getContext('2d');
		$(document).ready(function() {
			// $('.materialboxed').materialbox();
			RAY.init(ctx, 340, 300, 0);
		});

		var onprocess = function() {
			$('.determinate').css('width', 100 * RAY.progress / (RAY.width * RAY.height) + '%');
			try {
				$('[id^=doge]').css('top', $('#canv').height() * RAY.coords[RAY.progress].y / RAY.height - 20 + 'px');
			} catch (e) {}
		}

		var onfinish = function() {
			setTimeout(function() {
				$('.progress').css('display', 'none');
				$('[id^=doge]').css('display', 'none');
				Materialize.toast('Finish!', 1000);
			}, 1000);
		}

		function startTracing() {
			RAY.pause = false;
			$('.progress').css('display', 'block');
			$('[id^=doge]').css('display', 'block');
			RAY.traceCanvas(onprocess, onfinish);
			// setInterval(function(){RAY.traceCanvas();},100);
		}

		function pause() {
			RAY.pause = true;
		}

		function saveProgress() {

		}

		function loadProgress() {

		}
	</script>
</body>

</html>
